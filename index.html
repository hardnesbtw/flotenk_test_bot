<script>
    // Инициализация Telegram Web App
    let tg = window.Telegram.WebApp;
    
    // Расширяем на весь экран
    tg.expand();
    tg.ready();
    
    console.log("Telegram Web App initialized");
    console.log("tg version:", tg.version);
    console.log("tg platform:", tg.platform);
    
    // Обработчик отправки формы
    document.getElementById('feedbackForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        console.log("Form submitted");
        
        // Получаем и форматируем номер телефона
        const phoneValue = document.getElementById('phone').value.replace(/\D/g, '');
        const formattedPhone = '+7' + phoneValue;
        
        // Валидация номера телефона
        if (phoneValue.length !== 10) {
            alert('Пожалуйста, введите номер телефона полностью (10 цифр)');
            document.getElementById('phone').focus();
            return;
        }
        
        // Собираем данные формы
        const data = {
            fio: document.getElementById('fio').value,
            phone: formattedPhone,
            email: document.getElementById('email').value,
            customField: document.getElementById('customField').value,
            formType: formType
        };

        console.log("Data to send:", data);
        
        // Проверяем доступность метода sendData
        if (typeof tg.sendData !== 'function') {
            console.error("tg.sendData is not a function!");
            alert('Ошибка: функция отправки недоступна');
            return;
        }
        
        try {
            // Отправляем данные в Telegram бот
            console.log("Calling tg.sendData...");
            tg.sendData(JSON.stringify(data));
            console.log("tg.sendData called successfully");
            
            // Показываем сообщение об успехе
            document.getElementById('feedbackForm').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            document.querySelector('.submit-container').style.display = 'none';
            
        } catch (error) {
            console.error("Error in tg.sendData:", error);
            alert('Ошибка отправки: ' + error.message);
        }
    });
</script>
