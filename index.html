<script>
const tg = window.Telegram.WebApp;

tg.expand();
tg.ready();

// Показываем основную кнопку Telegram
tg.MainButton.setText("ОТПРАВИТЬ").show();

let formData = {};

// Собираем данные при изменении полей
document.querySelectorAll('input, textarea').forEach(element => {
    element.addEventListener('input', function() {
        formData = {
            fio: document.getElementById('simpleFio').value,
            phone: document.getElementById('simplePhone').value,
            email: document.getElementById('simpleEmail').value,
            customField: document.getElementById('simpleText').value,
            formType: new URLSearchParams(window.location.search).get('type') || 'question'
        };
        
        // Включаем кнопку если все поля заполнены
        if (formData.fio && formData.phone && formData.email && formData.customField) {
            tg.MainButton.enable();
        } else {
            tg.MainButton.disable();
        }
    });
});

// Обработчик основной кнопки
tg.MainButton.onClick(function() {
    if (formData.fio && formData.phone && formData.email && formData.customField) {
        tg.sendData(JSON.stringify(formData));
        tg.close();
    }
});

// Также оставляем обработчик обычной формы
document.getElementById('simpleForm').addEventListener('submit', function(e) {
    e.preventDefault();
    tg.MainButton.click();
});
// Проверка возможностей Web App
console.log('WebApp version:', window.Telegram.WebApp.version);
console.log('Platform:', window.Telegram.WebApp.platform);
console.log('sendData available:', typeof window.Telegram.WebApp.sendData === 'function');

if (typeof window.Telegram.WebApp.sendData !== 'function') {
    alert('Версия Telegram устарела. Обновите приложение.');
}
</script>
