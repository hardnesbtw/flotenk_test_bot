@router.message()
async def handle_fallback_data(message: types.Message, state: FSMContext):
    """Обработчик для ручной отправки данных"""
    try:
        # Пытаемся распарсить JSON из текстового сообщения
        data = json.loads(message.text)
        
        # Проверяем, что это данные нашей формы
        if all(key in data for key in ['fio', 'phone', 'email', 'customField', 'formType']):
            logging.info(f"Received fallback data: {data}")
            
            form_type = data.get('formType')
            if form_type == 'question':
                await send_quest(data['fio'], data['phone'], data['email'], data['customField'],
                               message.from_user.username, message.from_user.id,
                               message.message_id, None)
                await message.answer("✅ Ваш вопрос получен! Спасибо за ручную отправку.")
            elif form_type == 'application':
                await send_apply(data['fio'], data['phone'], data['email'], data['customField'],
                               message.from_user.username, message.from_user.id,
                               message.message_id, None)
                await message.answer("✅ Ваша заявка получена! Спасибо за ручную отправку.")
                
    except json.JSONDecodeError:
        # Это не JSON, пропускаем
        pass
    except Exception as e:
        logging.error(f"Error in fallback handler: {e}")
